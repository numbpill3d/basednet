(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{7492:function(e,t,n){Promise.resolve().then(n.bind(n,7736))},7907:function(e,t,n){"use strict";var i=n(5313);n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}})},7736:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var i=n(3827),r=n(4090),s=n(7907),l=n(3170),a=n(3779),o=n(8222);function d(){let e=(0,s.useRouter)(),{isLoading:t,isAuthenticated:n}=(0,a.a)(),[d,c]=(0,r.useState)([]),[u,h]=(0,r.useState)({total:0,pinned:0,totalSize:0}),[p,x]=(0,r.useState)(!0),[f,g]=(0,r.useState)(null),[y,m]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[C,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t||n||e.push("/")},[t,n,e]),(0,r.useEffect)(()=>{n&&S()},[n]);let S=async()=>{x(!0),g(null);try{var e,t;let n=await o.hi.ipfs.getContent();if(n.error)throw Error(n.error);c((null===(e=n.data)||void 0===e?void 0:e.content)||[]),h((null===(t=n.data)||void 0===t?void 0:t.stats)||{total:0,pinned:0,totalSize:0})}catch(e){console.error("Error fetching IPFS content:",e),g(e.message)}finally{x(!1)}},A=async e=>{if(e.preventDefault(),!y){g("CID is required");return}N(!0),g(null);try{let e=await o.hi.ipfs.createContent({cid:y,filename:j||void 0,contentType:v||void 0});if(e.error)throw Error(e.error);m(""),b(""),w(""),S()}catch(e){g(e.message)}finally{N(!1)}},k=async(e,t)=>{try{let n=await o.hi.ipfs.updatePinStatus(e,!t);if(n.error)throw Error(n.error);c(n=>n.map(n=>n.cid===e?{...n,pinned:!t}:n)),h(e=>({...e,pinned:t?Math.max(0,e.pinned-1):e.pinned+1}))}catch(e){g(e.message)}},E=async e=>{if(confirm("Are you sure you want to delete this content?"))try{let t=await o.hi.ipfs.deleteContent(e);if(t.error)throw Error(t.error);S()}catch(e){g(e.message)}},P=e=>{if(void 0===e)return"Unknown";if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]};return t?(0,i.jsxs)("div",{className:"win98-desktop",children:[(0,i.jsx)(l.Z,{}),(0,i.jsxs)("div",{className:"window",style:{maxWidth:"600px",margin:"20px auto"},children:[(0,i.jsx)("div",{className:"window-title",children:(0,i.jsx)("span",{children:"Loading..."})}),(0,i.jsx)("div",{className:"window-content",style:{textAlign:"center",padding:"20px"},children:(0,i.jsx)("div",{className:"loading-98"})})]})]}):n?(0,i.jsxs)("div",{className:"win98-desktop",children:[(0,i.jsx)(l.Z,{}),(0,i.jsxs)("div",{className:"window",style:{maxWidth:"900px",margin:"20px auto"},children:[(0,i.jsxs)("div",{className:"window-title",children:[(0,i.jsx)("span",{children:"IPFS Content Dashboard"}),(0,i.jsx)("span",{children:"\xd7"})]}),(0,i.jsxs)("div",{className:"window-content",children:[f&&(0,i.jsxs)("div",{style:{backgroundColor:"#ffdddd",border:"1px solid #ff0000",padding:"10px",marginBottom:"15px"},children:["Error: ",f]}),(0,i.jsxs)("div",{style:{display:"flex",marginBottom:"20px"},children:[(0,i.jsxs)("div",{style:{flex:1,padding:"10px",border:"1px solid #c0c0c0"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 10px 0"},children:"Content Stats"}),(0,i.jsx)("table",{style:{width:"100%"},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Total Files:"}),(0,i.jsx)("td",{children:u.total})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Pinned Files:"}),(0,i.jsx)("td",{children:u.pinned})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Total Size:"}),(0,i.jsx)("td",{children:P(u.totalSize)})]})]})})]}),(0,i.jsxs)("div",{style:{flex:1,padding:"10px",border:"1px solid #c0c0c0",marginLeft:"10px"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 10px 0"},children:"Add New Content"}),(0,i.jsxs)("form",{onSubmit:A,children:[(0,i.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,i.jsx)("label",{htmlFor:"cid",style:{display:"block",marginBottom:"5px"},children:"CID:"}),(0,i.jsx)("input",{id:"cid",type:"text",value:y,onChange:e=>m(e.target.value),className:"input-98",style:{width:"100%"},placeholder:"Qm...",required:!0})]}),(0,i.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,i.jsx)("label",{htmlFor:"filename",style:{display:"block",marginBottom:"5px"},children:"Filename (optional):"}),(0,i.jsx)("input",{id:"filename",type:"text",value:j,onChange:e=>b(e.target.value),className:"input-98",style:{width:"100%"},placeholder:"example.jpg"})]}),(0,i.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,i.jsx)("label",{htmlFor:"contentType",style:{display:"block",marginBottom:"5px"},children:"Content Type (optional):"}),(0,i.jsx)("input",{id:"contentType",type:"text",value:v,onChange:e=>w(e.target.value),className:"input-98",style:{width:"100%"},placeholder:"image/jpeg"})]}),(0,i.jsx)("button",{type:"submit",className:"btn-98",disabled:C,children:C?"Adding...":"Add Content"})]})]})]}),(0,i.jsx)("h3",{children:"Your IPFS Content"}),p?(0,i.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,i.jsx)("div",{className:"loading-98"})}):0===d.length?(0,i.jsx)("p",{children:"You don't have any IPFS content yet. Add some using the form above."}):(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{backgroundColor:"#c0c0c0"},children:[(0,i.jsx)("th",{style:{padding:"8px",textAlign:"left"},children:"Filename"}),(0,i.jsx)("th",{style:{padding:"8px",textAlign:"left"},children:"CID"}),(0,i.jsx)("th",{style:{padding:"8px",textAlign:"left"},children:"Type"}),(0,i.jsx)("th",{style:{padding:"8px",textAlign:"right"},children:"Size"}),(0,i.jsx)("th",{style:{padding:"8px",textAlign:"center"},children:"Pinned"}),(0,i.jsx)("th",{style:{padding:"8px",textAlign:"center"},children:"Actions"})]})}),(0,i.jsx)("tbody",{children:d.map(e=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #c0c0c0"},children:[(0,i.jsx)("td",{style:{padding:"8px"},children:e.filename||"Unnamed"}),(0,i.jsx)("td",{style:{padding:"8px"},children:(0,i.jsxs)("a",{href:"https://ipfs.io/ipfs/".concat(e.cid),target:"_blank",rel:"noopener noreferrer",children:[e.cid.substring(0,10),"..."]})}),(0,i.jsx)("td",{style:{padding:"8px"},children:e.content_type||"Unknown"}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"right"},children:P(e.size)}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"center"},children:(0,i.jsx)("input",{type:"checkbox",checked:e.pinned,onChange:()=>k(e.cid,e.pinned),"aria-label":"Pin ".concat(e.filename||"content")})}),(0,i.jsx)("td",{style:{padding:"8px",textAlign:"center"},children:(0,i.jsx)("button",{className:"btn-98 btn-small",onClick:()=>E(e.cid),"aria-label":"Delete ".concat(e.filename||"content"),children:"Delete"})})]},e.id))})]})]})]})]}):null}},3170:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var i=n(3827);n(4090);var r=n(8792),s=n(3779);function l(){let{user:e,isAuthenticated:t,isLoading:n,login:l,logout:a}=(0,s.a)();return(0,i.jsxs)("nav",{className:"navbar-98",children:[(0,i.jsx)("button",{className:"btn-98",children:"Start"}),(0,i.jsx)("div",{style:{marginLeft:"10px"},children:"|"}),(0,i.jsx)(r.default,{href:"/",className:"btn-98",children:"Home"}),(0,i.jsx)(r.default,{href:"/browse",className:"btn-98",children:"Browse"}),(0,i.jsx)(r.default,{href:"/webrings",className:"btn-98",children:"Webrings"}),n?(0,i.jsx)("div",{className:"loading-98",style:{marginLeft:"auto"}}):t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.default,{href:"/dashboard",className:"btn-98",children:"My Dashboard"}),(0,i.jsx)(r.default,{href:"/profile",className:"btn-98",children:"Profile"}),(0,i.jsxs)("button",{className:"btn-98",style:{marginLeft:"auto"},onClick:()=>a(),children:["Logout (",null==e?void 0:e.username,")"]})]}):(0,i.jsx)("button",{className:"btn-98",style:{marginLeft:"auto"},onClick:()=>l(),children:"Login"}),(0,i.jsx)(r.default,{href:"/help",className:"btn-98",children:"Help"})]})}},3779:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return d}});var i=n(3827),r=n(4090),s=n(1126),l=n(8222);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,{data:n,status:o}=(0,s.useSession)(),[d,c]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[p,x]=(0,r.useState)(!0),[f,g]=(0,r.useState)(null),y=async()=>{if(!(null==n?void 0:n.user)){c(null),h(null),x(!1);return}try{var e,t;x(!0),g(null);let n=await l.hi.user.getCurrentUser();if(n.error)throw Error(n.error);c((null===(e=n.data)||void 0===e?void 0:e.user)||null);let i=await l.hi.profile.getProfile();if(i.error)throw Error(i.error);h((null===(t=i.data)||void 0===t?void 0:t.profile)||null)}catch(e){console.error("Error fetching user data:",e),g(e.message)}finally{x(!1)}};(0,r.useEffect)(()=>{"loading"!==o&&y()},[n,o]);let m=async()=>{try{await (0,s.signIn)("indieauth",{callbackUrl:"/"})}catch(e){console.error("Login error:",e),g(e.message)}},j=async()=>{try{await (0,s.signOut)({callbackUrl:"/"}),c(null),h(null)}catch(e){console.error("Logout error:",e),g(e.message)}},b=async()=>{await y()};return(0,i.jsx)(a.Provider,{value:{user:d,profile:u,isLoading:p,isAuthenticated:!!d,error:f,login:m,logout:j,refreshUserData:b},children:t})}function d(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8222:function(e,t,n){"use strict";n.d(t,{hi:function(){return s}});class i extends Error{constructor(e,t){super(e),this.status=t,this.name="ApiError"}}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=await fetch(e,{...t,headers:{"Content-Type":"application/json",...t.headers}}),r=await n.json();if(!n.ok)throw new i(r.error||"An error occurred",n.status);return{data:r}}catch(e){return{error:e.message}}}let s={user:{getCurrentUser:async()=>r("/api/users?me=true"),getUserByUsername:async e=>r("/api/users/".concat(e)),updateUser:async e=>r("/api/users",{method:"PUT",body:JSON.stringify(e)}),listUsers:async function(){let{limit:e=10,offset:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r("/api/users?limit=".concat(e,"&offset=").concat(t))}},profile:{getProfile:async()=>r("/api/profile"),updateProfile:async e=>r("/api/profile",{method:"PUT",body:JSON.stringify(e)})},ipfs:{getContent:async function(){let{limit:e=10,offset:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r("/api/ipfs?limit=".concat(e,"&offset=").concat(t))},getContentByCid:async e=>r("/api/ipfs/".concat(e)),createContent:async e=>r("/api/ipfs",{method:"POST",body:JSON.stringify(e)}),updatePinStatus:async(e,t)=>r("/api/ipfs/".concat(e),{method:"PATCH",body:JSON.stringify({pinned:t})}),deleteContent:async e=>r("/api/ipfs/".concat(e),{method:"DELETE"})}}}},function(e){e.O(0,[126,792,971,69,744],function(){return e(e.s=7492)}),_N_E=e.O()}]);