"use strict";(()=>{var e={};e.id=701,e.ids=[701],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},8709:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3477:e=>{e.exports=require("querystring")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1073:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>R,requestAsyncStorage:()=>E,routeModule:()=>p,serverHooks:()=>T,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{GET:()=>l,PUT:()=>d});var a=t(5419),n=t(9108),i=t(9678),u=t(8070),o=t(2002),c=t(4111);async function l(e){try{let r=new URL(e.url);if("true"===r.searchParams.get("me")){let e=await (0,o.ts)();if(!e)return u.Z.json({error:"Unauthorized"},{status:401});return u.Z.json({user:e})}{await (0,o.mk)();let e=parseInt(r.searchParams.get("limit")||"10"),t=parseInt(r.searchParams.get("offset")||"0"),s=await c.T.list(e,t);return u.Z.json({users:s})}}catch(e){if(console.error("Error fetching users:",e),"Authentication required"===e.message)return u.Z.json({error:"Unauthorized"},{status:401});return u.Z.json({error:"Failed to fetch users"},{status:500})}}async function d(e){try{let r=await (0,o.ts)();if(!r)return u.Z.json({error:"Unauthorized"},{status:401});let t=await e.json(),s={};for(let e of["username","email"])void 0!==t[e]&&(s[e]=t[e]);if(0===Object.keys(s).length)return u.Z.json({error:"No valid update fields provided"},{status:400});let a=await c.T.update(r.id,s);if(!a)return u.Z.json({error:"Failed to update user"},{status:500});return u.Z.json({user:a})}catch(e){return console.error("Error updating user:",e),u.Z.json({error:"Failed to update user"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"C:\\Users\\adoni\\Desktop\\projects\\basednet\\src\\app\\api\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:E,staticGenerationAsyncStorage:m,serverHooks:T,headerHooks:h,staticGenerationBailout:y}=p,f="/api/users/route";function R(){return(0,i.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:m})}},9470:(e,r,t)=>{t.r(r),t.d(r,{GET:()=>n,POST:()=>n,authOptions:()=>a});var s=t(9605);!function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let a={providers:[{id:"indieauth",name:"IndieAuth",type:"oauth",authorization:{url:"https://indieauth.com/auth",params:{scope:"profile email"}},token:{url:"https://tokens.indieauth.com/token"},userinfo:{url:"https://indieauth.com/userinfo",request:async({tokens:e,client:r})=>({id:e.me,name:e.name||e.me,email:e.email,image:e.photo})},profile:e=>({id:e.id,name:e.name,email:e.email,image:e.image}),clientId:process.env.INDIE_AUTH_CLIENT_ID,clientSecret:process.env.INDIE_AUTH_CLIENT_SECRET}],callbacks:{async signIn({user:e,account:r,profile:t}){try{return await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())(async e=>{let r=await e.query("SELECT * FROM users WHERE auth_domain = $1",[t.id]);0===r.rows.length&&(await e.query("INSERT INTO users (username, auth_domain, email) VALUES ($1, $2, $3)",[t.name,t.id,t.email]),await e.query("INSERT INTO profiles (user_id) VALUES (currval('users_id_seq'))"))}),!0}catch(e){return console.error("Error during sign in:",e),!1}},async session({session:e,user:r}){try{return await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}())(async r=>{let t=await r.query("SELECT * FROM users WHERE email = $1",[e.user?.email]);return t.rows[0]?{...e,user:{...e.user,id:t.rows[0].id,username:t.rows[0].username}}:e})}catch(r){return console.error("Error getting session:",r),e}}},pages:{signIn:"/auth/signin",error:"/auth/error"},debug:!1},n=(0,s.ZP)(a)},9537:(e,r,t)=>{t.d(r,{Z:()=>s});let s=new(require("pg")).Pool({user:process.env.POSTGRES_USER,password:process.env.POSTGRES_PASSWORD,host:process.env.POSTGRES_HOST,port:parseInt(process.env.POSTGRES_PORT||"5432"),database:process.env.POSTGRES_DB,ssl:{rejectUnauthorized:!1}})},5566:(e,r,t)=>{t.d(r,{t:()=>a});var s=t(9537);class a{static async create(e,r){let t=["user_id",...Object.keys(r)],a=[e,...Object.values(r)],n=t.map((e,r)=>`$${r+1}`).join(", "),i=`
      INSERT INTO profiles (${t.join(", ")})
      VALUES (${n})
      RETURNING *
    `;return(await s.Z.query(i,a)).rows[0]}static async findByUserId(e){return(await s.Z.query("SELECT * FROM profiles WHERE user_id = $1",[e])).rows[0]||null}static async update(e,r){let t=["display_name","bio","avatar_url","theme_preferences","custom_css","custom_html","social_links"],a=Object.keys(r).filter(e=>t.includes(e));if(0===a.length)return null;let n=a.map((e,r)=>`${e} = $${r+2}`).join(", "),i=a.map(e=>{let t=r[e];return["theme_preferences","social_links"].includes(e)?JSON.stringify(t):t}),u=`
      UPDATE profiles 
      SET ${n}, updated_at = CURRENT_TIMESTAMP 
      WHERE user_id = $1 
      RETURNING *
    `;return(await s.Z.query(u,[e,...i])).rows[0]||null}static async delete(e){return(await s.Z.query("DELETE FROM profiles WHERE user_id = $1 RETURNING id",[e])).rowCount>0}static async getTheme(e){let r=await s.Z.query("SELECT theme_preferences FROM profiles WHERE user_id = $1",[e]);return r.rows[0]?.theme_preferences||null}static async updateTheme(e,r){let t=`
      UPDATE profiles 
      SET theme_preferences = $2, updated_at = CURRENT_TIMESTAMP 
      WHERE user_id = $1
    `;return(await s.Z.query(t,[e,JSON.stringify(r)])).rowCount>0}}},4111:(e,r,t)=>{t.d(r,{T:()=>a});var s=t(9537);class a{static async create(e,r,t){let a=`
      INSERT INTO users (username, email, auth_domain)
      VALUES ($1, $2, $3)
      RETURNING *
    `;return(await s.Z.query(a,[e,r,t])).rows[0]}static async findById(e){return(await s.Z.query("SELECT * FROM users WHERE id = $1",[e])).rows[0]||null}static async findByUsername(e){return(await s.Z.query("SELECT * FROM users WHERE username = $1",[e])).rows[0]||null}static async update(e,r){let t=["username","email","auth_domain"],a=Object.keys(r).filter(e=>t.includes(e));if(0===a.length)return null;let n=a.map((e,r)=>`${e} = $${r+2}`).join(", "),i=a.map(e=>r[e]),u=`
      UPDATE users 
      SET ${n}, updated_at = CURRENT_TIMESTAMP 
      WHERE id = $1 
      RETURNING *
    `;return(await s.Z.query(u,[e,...i])).rows[0]||null}static async delete(e){return((await s.Z.query("DELETE FROM users WHERE id = $1 RETURNING id",[e])).rowCount??0)>0}static async list(e=10,r=0){return(await s.Z.query("SELECT * FROM users ORDER BY created_at DESC LIMIT $1 OFFSET $2",[e,r])).rows}}},2002:(e,r,t)=>{t.d(r,{Fs:()=>u,mk:()=>o,ts:()=>i});var s=t(9605),a=t(9470),n=t(4111);async function i(){let e=await (0,s.Z1)(a.authOptions);return e?.user?.id?await n.T.findById(e.user.id):null}async function u(e,r){return e===r}async function o(){let e=await (0,s.Z1)(a.authOptions);if(!e?.user?.id)throw Error("Authentication required");return e}t(5566)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,536,70],()=>t(1073));module.exports=s})();