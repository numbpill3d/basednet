"use strict";(()=>{var e={};e.id=912,e.ids=[912],e.modules={58097:e=>{e.exports=require("@sentry/nextjs")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},15206:e=>{e.exports=require("zlib")},2094:(e,t,r)=>{r.r(t),r.d(t,{DELETE:()=>y,GET:()=>m,HEAD:()=>T,OPTIONS:()=>q,PATCH:()=>x,POST:()=>E,PUT:()=>g,authOptions:()=>p}),r(80001);var a=r(16915),s=r(61907),n=r(58097),o=r(54580),i=r(8317),u=r(35900);if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is not defined");let c=new u.Pool({connectionString:process.env.DATABASE_URL,max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3});async function l(e){let t=await c.connect();try{await t.query("BEGIN");let r=await e(t);return await t.query("COMMIT"),r}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}}c.query("SELECT NOW()",e=>{e?console.error("Database connection error:",e.message):console.log("Database connected successfully")}),process.on("SIGTERM",async()=>{console.log("Closing database pool"),await c.end()});let p={providers:[{id:"indieauth",name:"IndieAuth",type:"oauth",authorization:{url:"https://indieauth.com/auth",params:{scope:"profile email"}},token:{url:"https://tokens.indieauth.com/token"},userinfo:{url:"https://indieauth.com/userinfo",request:async({tokens:e,client:t})=>({id:e.me,name:e.name||e.me,email:e.email,image:e.photo})},profile:e=>({id:e.id,name:e.name,email:e.email,image:e.image}),clientId:process.env.INDIE_AUTH_CLIENT_ID,clientSecret:process.env.INDIE_AUTH_CLIENT_SECRET}],callbacks:{async signIn({user:e,account:t,profile:r}){try{return await l(async e=>{let t=await e.query("SELECT * FROM users WHERE auth_domain = $1",[r.id]);0===t.rows.length&&(await e.query("INSERT INTO users (username, auth_domain, email) VALUES ($1, $2, $3)",[r.name,r.id,r.email]),await e.query("INSERT INTO profiles (user_id) VALUES (currval('users_id_seq'))"))}),!0}catch(e){return console.error("Error during sign in:",e),!1}},async session({session:e,user:t}){try{return await l(async t=>{let r=await t.query("SELECT * FROM users WHERE email = $1",[e.user?.email]);return r.rows[0]?{...e,user:{...e.user,id:r.rows[0].id,username:r.rows[0].username}}:e})}catch(t){return console.error("Error getting session:",t),e}}},pages:{signIn:"/auth/signin",error:"/auth/error"},debug:!1},d=(0,i.ZP)(p);function h(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,i)=>{let u,c,l;try{let e=o.requestAsyncStorage.getStore();u=(0,a.h)((0,s.x)([e,"optionalAccess",e=>e.headers,"access",e=>e.get,"call",e=>e("sentry-trace")]),()=>void 0),c=(0,a.h)((0,s.x)([e,"optionalAccess",e=>e.headers,"access",e=>e.get,"call",e=>e("baggage")]),()=>void 0),l=(0,s.x)([e,"optionalAccess",e=>e.headers])}catch(e){}return n.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/api/auth/[...nextauth]",sentryTraceHeader:u,baggageHeader:c,headers:l}).apply(r,i)}})}let m=h(d,"GET"),E=h(d,"POST"),g=h(void 0,"PUT"),x=h(void 0,"PATCH"),y=h(void 0,"DELETE"),T=h(void 0,"HEAD"),q=h(void 0,"OPTIONS")},63729:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>p,originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>u,routeModule:()=>i,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>d});var a=r(13223),s=r(6566),n=r(77419),o=r(2094);let i=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"C:\\Users\\adoni\\Desktop\\projects\\basednet\\src\\app\\api\\auth\\[...nextauth]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:l,headerHooks:p,staticGenerationBailout:d}=i,h="/api/auth/[...nextauth]/route";function m(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}},80001:(e,t,r)=>{var a=r(58097),s="undefined"!=typeof global?global:"undefined"!=typeof self?self:{};s.__sentryRewritesTunnelPath__=void 0,s.SENTRY_RELEASE={id:"wdkRqJwFkIUdQPuSy7-Vq"},s.__sentryBasePath=void 0,s.__rewriteFramesDistDir__=".next",a.init({dsn:process.env.SENTRY_DSN,tracesSampleRate:.1,integrations:[new a.BrowserTracing({tracePropagationTargets:["localhost",/^https:\/\/[^/]*\.basednet\.com/]})],environment:"production",beforeSend(e){if(e.exception){let t=e.exception.values?.[0]?.value;if(t?.includes("ResizeObserver loop"))return null}return e},debug:!1,maxBreadcrumbs:50,attachStacktrace:!0})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[565,834],()=>r(63729));module.exports=a})();
//# sourceMappingURL=route.js.map